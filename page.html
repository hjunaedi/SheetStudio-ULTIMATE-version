<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Loading...</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:system-ui,sans-serif;min-height:100vh}
.loader{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:100vh;gap:16px}
.spinner{width:40px;height:40px;border:3px solid #e5e7eb;border-top-color:#2563EB;border-radius:50%;animation:spin .8s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.error{text-align:center;padding:80px 20px}
.error__icon{font-size:64px;margin-bottom:16px}
.btn{display:inline-block;padding:14px 28px;background:#2563EB;color:#fff;border-radius:12px;text-decoration:none;margin-top:20px}
</style>
</head>
<body>
<div class="loader"><div class="spinner"></div><p>Memuat...</p></div>
<script>
(function(){
'use strict';

const API='https://script.google.com/macros/s/AKfycbwe9X_Af--lDfIpbmV12ezO7e7ZOWMOlf2uQzPaFmeP1TagPYfhEqnaPlwICf3dtZ_b/exec';
const slug=new URLSearchParams(location.search).get('s');

console.log('üîç Loading page:',slug);

if(!slug){
  document.body.innerHTML='<div class="error"><div class="error__icon">‚ö†Ô∏è</div><h2>Error</h2><p>Tidak ada parameter ?s=slug</p><a href="/" class="btn">Beranda</a></div>';
}else{
  fetch(API)
    .then(r=>{
      console.log('üì° Response:',r.status);
      return r.json();
    })
    .then(response=>{
      // CRITICAL FIX: Handle wrapped response
      console.log('üì¶ Raw response type:',typeof response);
      
      let data;
      if(Array.isArray(response)){
        data=response;
      }else if(response.data && Array.isArray(response.data)){
        data=response.data;
      }else if(response.items && Array.isArray(response.items)){
        data=response.items;
      }else{
        throw new Error('Response is not an array');
      }
      
      console.log('üì¶ Data:',data.length,'items');
      console.log('üìÑ All pages:',data.filter(i=>i.tipe==='page').map(p=>p.slug).join(', '));
      
      const page=data.find(i=>i.slug===slug && i.tipe==='page');
      
      if(!page){
        console.error('‚ùå Page not found:',slug);
        document.body.innerHTML='<div class="error"><div class="error__icon">‚ö†Ô∏è</div><h2>Halaman Tidak Ditemukan</h2><p>Halaman "'+slug+'" tidak ada.</p><a href="/" class="btn">Beranda</a></div>';
      }else{
        console.log('‚úÖ Page found:',page.title);
        console.log('üìù Content length:',page.content?.length||0);
        
        document.title=page.title;
        document.body.innerHTML=page.content||'<p>Content kosong</p>';
        
        // Execute scripts
        document.querySelectorAll('script').forEach(s=>{
          const n=document.createElement('script');
          Array.from(s.attributes).forEach(a=>n.setAttribute(a.name,a.value));
          n.textContent=s.textContent;
          s.parentNode.replaceChild(n,s);
        });
        
        console.log('üéâ Page rendered!');
      }
    })
    .catch(e=>{
      console.error('‚ùå Error:',e);
      document.body.innerHTML='<div class="error"><div class="error__icon">‚ö†Ô∏è</div><h2>Error</h2><p>'+e.message+'</p><a href="/" class="btn">Beranda</a></div>';
    });
}
})();
</script>
</body>
</html>
